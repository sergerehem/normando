//import model.Ponto
import com.google.appengine.api.datastore.Entity
import util.Clock

def clock = new Clock()

println params

def getPontoById(pontoId) {
	def p = datastore.execute {
		select single from "ponto"
		where id == pontoId
	}
}

switch (params.op) {
	case "registrar":

		def pontoId = params.email+":"+clock.date
		def p = getPontoById(pontoId)
		if (p == null) {
			p = new Entity("ponto")
			p.id = pontoId
			p.email = params.email
			p.mes = clock.month
			p.data = clock.date
			p[params.turno] = params.hora
		} else {
			p[params.turno] = params.hora
		}
		p.save()

		println "SALVOS COM SUCESSO!"
		break
	case "listar":
		println "listar"
		def pontoId = user.email+":"+clock.date
		def p = getPontoById(pontoId)
		println "achei ponto $pontoId $p"
		forward "/WEB-INF/pages/ponto.gtpl"
}
